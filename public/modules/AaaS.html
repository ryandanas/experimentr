<div id="specification">
	<h1>Specification</h1>
  <div id="spec">
  </div>
</div>
<div id="question">
  <h1>Question</h1>
  <div id="quest">
    <p>Please edit the specification to make the assertion true, and have your answer checked.</p>
    <div style="text-align:center;">
      <button id="runalloy">Check Specification</button>
    </div>
    <p id="feedback">
      Status: <span id="status"></span>.
    </p>
  </div>
</div>
<div id="scenarios">
	<h1>Counterexamples</h1>
	<div style="text-align:center;">
		<button id="prev">prev</button>
		<span id="num">1</span>
		<span>of</span>
		<span id="all">1</span>
		<button id="next">next</button>
	</div>
	<div id="scenario">
	</div>
</div>
<div id="assertion">
  <h1>Assertion</h1>
    <div id="assert">
    </div>
</div>

<script>
/* SPEC */
  var specCM = CodeMirror(d3.select("#spec")[0][0], {
    value: 
"abstract sig Person {} \n\
sig Student extends Person {} \n\
sig Professor extends Person {} \n\
sig Class { \n\
  assistant_for: set Student, \n\
  instructor_of: one Professor \n\
} \n\
sig Assignment { \n\
  associated_with: one Class, \n\
  assigned_to: some Student \n\
} \n\
\n\
pred PolicyAllowsGrading(s: Person, a: Assignment) { \n\
  s in a.associated_with.assistant_for or s in a.associated_with.instructor_of \n\
}",
    mode: "text/x-java"
  });
/* ASSERT */
  var assertCM = CodeMirror(d3.select("#assert")[0][0], {
    value:
"assert NoOneCanGradeTheirOwnAssignment {\n\
  all s : Person \n\
  | all a: Assignment \n\
  | PolicyAllowsGrading[s, a] implies not s in a.assigned_to\n\
}\n\
check NoOneCanGradeTheirOwnAssignment",
mode : "text/x-java",
readOnly: true 
  });
/* SCENARIOS */
var scenarioCM = CodeMirror(d3.select("#scenario")[0][0], {
    value: "",
mode : "text/x-java",
readOnly: true 
  });

  d3.select("#runalloy").on('click', runalloy);
  function runalloy (){
    var req = new XMLHttpRequest();
    var url = "/alloy?spec="+specCM.getValue()+assertCM.getValue();
    req.open("GET", url, false);
    req.send();
    var response = req.response.split('\n');
    var status = response[0];
    response.shift();
    var info = response.join('\n');
    d3.select("#status").text(status);
    scenarioCM.setValue(info);
  }
  runalloy();
</script>

