<!DOCTYPE html>

<meta charset="utf-8">
<title>Survey</title>

<script src="components/d3js/d3.v3.min.js"></script>
<script src="experimentr.js"></script>

<style>
  * {
      color: #333;
      font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
    }
  body {
    margin: 1em auto 4em auto;
    width: 960px;
  }
  button {
    font-size: large; 
  }
  h1 {
    font-size: 150%;
    margin-top: 0em;
    margin-bottom: .5em;
    margin-left: 0;
    margin-right: 0;
    font-weight: normal;
  }
  ul, ol {
    margin-top: 0em;
    margin-bottom: 0em;
    margin-left: 0em;
    margin-right: 0em;
    padding-left: 1.5em;
  }
  b{
    font-weight: normal;
    text-shadow : 0 0 0 #333;
  }
  i {
    text-shadow : 0 0 0 #333;
  }
  u {
    text-shadow : 0 0 0 #333;
  }
  #experimentr {
    margin: 0em auto 0em auto;
    width: 720px;
  }
  #control {
    margin-top: 1em;
  }
  #next-button {
    float: right;
    font-size: xx-large;
    font-weight: bold;
  }
  #specification, #assertion, #question, #scenarios, #teacher {
    border: 1px solid #AAA;
    border-radius: 5px;
    padding: 5px;
    margin: 0px 0px 0px 0px;
    background: #CCC;
  }
  #spec, #assert, #quest, #scenario, #teach {
    border: 1px solid #AAA;
    border-radius: 5px;
    padding: 5px;
    background: #FFF;
  }
  #specification {
    width: 50%;
    float:left;
  }
  #assertion{
    width: 45%;
    float: left;
  }
  #question{
    width: 50%;
    float: left;  
  }
  #scenarios {
    width: 45%;
    float: right;
    margin: 15px 0px 15px 0px;
  }
  #teacher {
    width: 45%;
    float: right;
  }
</style>

<body></body>

<script>
/* OVERALL EXPERIMENT FUNCTIONS */
  var data = {};
  var eid = "RN"; // CHANGE IF GETSEQUENCE IS CHANGED
  experimentr.sequence(getsequence()).start();
  var junktimer;
  function getsequence() {
    var pre = ['modules/consent.html'];
    var teach = ['modules/filesystem_teachsee.html', 'modules/familytree_teachdo.html'];
    var minimal = ['modules/gradebook_s1min.html', 'modules/addressbook_s1min.html'];
    var nonminimal = ['modules/gradebook_s2non.html', 'modules/addressbook_s2non.html'];
    var post = ['modules/debrief.html'];
    var tasks = (teach.concat(nonminimal)).concat(minimal);
    return (pre.concat(tasks)).concat(post);
  }
/* GENERIC TASK FUNCTIONS */
  function init(tid, numoptions) {
    data = {};
    data['_start_'+tid+eid] = Date.now();
    data['_scale_'+tid+eid] = numoptions;
    data['_clicks_'+tid+eid] = 0;
    data['_clicktime_'+tid+eid] = [];
    data['_clickorder_'+tid+eid] = [];
    var all = Number(d3.select('#all').text());
    data['_scenariotime_'+tid+eid] = Array.apply(null, Array(all)).map(Number.prototype.valueOf,0);
    junktimer = Date.now();
    //
    experimentr.hideNext();
    next(tid);
    d3.selectAll('button').on('mouseover', fizz);
    d3.selectAll('button').on('mouseout', buzz);
  }
  function prev(tid) {
    var num = Number(d3.select('#num').text());
    var all = Number(d3.select('#all').text());
    if(num > 1) {
      d3.select('#s'+num).style('display', 'none');
      num = num-1; 
      d3.select('#s'+num).style('display', null);
      d3.select('#num').text(""+num);
      //
      var diff = Date.now() - junktimer;
      (data['_scenariotime_'+tid+eid])[num] = ((data['_scenariotime_'+tid+eid])[num]) + diff;
      junktimer = Date.now();
    }
  }
  function next(tid) {
    var num = Number(d3.select('#num').text());
    var all = Number(d3.select('#all').text());
    if(num < all) {
      d3.select('#s'+num).style('display', 'none');
      num = num+1;
      d3.select('#s'+num).style('display', null);
      d3.select('#num').text(""+num);
      //
      if(num-2 >= 0) {
        var diff = Date.now() - junktimer;
        (data['_scenariotime_'+tid+eid])[num-2] = ((data['_scenariotime_'+tid+eid])[num-2]) + diff;
        junktimer = Date.now();
      }
    }
  }
  function fizz() {
    d3.select('#a'+d3.event.target.id).style("background-color", "#FFA");
  }
  function buzz() {
    d3.select('#a'+d3.event.target.id).style("background-color", null);
  }
  function foo(tid) {
    d3.select('#feedback').text("Your selection is not the part of the specification that requires changes. Please try again.");
    d3.select('#'+d3.event.target.id).attr("disabled", true);
    d3.select('#'+d3.event.target.id).style("background-color", "#FAA");
    d3.select('#a'+d3.event.target.id).style("background-color", "#FAA");
    //
    data['_clicks_'+tid+eid] = data['_clicks_'+tid+eid] + 1;
    var ctime = Date.now() - data['_start_'+tid+eid];
    data['_clicktime_'+tid+eid] = (data['_clicktime_'+tid+eid]).concat([ctime]);
    data['_clickorder_'+tid+eid] = (data['_clickorder_'+tid+eid]).concat([d3.event.target.id]);
  }
  function bar(tid) {
    d3.select('#feedback').text("Correct! Press next to proceed to the next situation.");
    d3.select('#'+d3.event.target.id).attr("disabled", true);
    d3.selectAll('button').attr("disabled", true);
    d3.select('#'+d3.event.target.id).style("background-color", "#AFA");
    d3.select('#a'+d3.event.target.id).style("background-color", "#AFA");
    experimentr.showNext();
    d3.select('#next-button').attr('disabled', null);
    //
    data['_clicks_'+tid+eid] = data['_clicks_'+tid+eid] + 1;
    var ctime = Date.now() - data['_start_'+tid+eid];
    data['_clicktime_'+tid+eid] = (data['_clicktime_'+tid+eid]).concat([ctime]);
    data['_clickorder_'+tid+eid] = (data['_clickorder_'+tid+eid]).concat([d3.event.target.id]);
    data['_end_'+tid+eid] = Date.now();
    data['_time_'+tid+eid] = parseFloat(data['_end_'+tid+eid]) - parseFloat(data['_start_'+tid+eid]);
    var diff = Date.now() - junktimer;
    var num = Number(d3.select('#num').text());
    (data['_scenariotime_'+tid+eid])[num-1] = ((data['_scenariotime_'+tid+eid])[num-1]) + diff;
    experimentr.addData(data);
  }
  /* DOCUMENTATION
   all data is recorded in _<metric>_<experimentID><taskID> form
   the <experimentID><taskID> should denote the experiment condition
   generic, parameterized code goes here. anything task specific goes in their module
   sorry for the obfuscated names. i did that to avoid quick CTRL+F to win cheaters.
   */
  /*
   CONDITIONS
   spec             F(filesystem), T(familytree), G(gradebook), A(addressbook)
   phrasing         o(original), r(rephrase)
   scenario         m(minimal), n(nonmimimal)
   phrasing first   O, R
   scenario first   M, N
   */
</script>
