<!DOCTYPE html>
<meta charset="utf-8">
<title>Survey</title>
<script src="scripts/d3/d3.min.js" charset="utf-8"></script>
<script src="experimentr.js"></script>
<link rel="stylesheet" type="text/css" href="css/main.css" />
<link rel="stylesheet" type="text/css" href="css/toyfinder.css" />

<body>
</body>

<script>
  /* 
  all data is recorded in _<taskID>_<metric> form
  the <taskID> should denote the trial conditions (see example below)
  generic, parameterized code goes here. anything task specific goes in their module

  CONDITIONS
  experimentID     order of the tasks
  taskID           the task, which is composed of independent variables
  spec            which specification (ex// G = gradebook spec)
  phrasing        which phrasing      (ex// O = original phrasing)
  model           which model         (ex// M = minimal model)
  */
  function getexperiment() {
    return ['modules/t1.html','modules/t2.html','modules/t3.html','modules/t4.html','modules/t5.html','modules/t6.html','modules/t7.html'];
    /*
    if(Math.random() < .5) { return ['modules/AOM.html'] }
    else { return ['modules/AOC.html'] }
    */
  }
  var data = {};
  var experiment = getexperiment(); 
  var experimentID = experiment.toString();
  var task = 0;
  var taskID = null;
  function getsequence() {
    var pre = ['modules/consent/training.html'];
    var post = ['modules/debrief/training.html'];
    var tasks = experiment;
    //return tasks;
    return pre.concat(tasks).concat(post);
  }
  function init(answers) {
    taskID = experiment[task];
    data = {};
    data['userAgent'] = navigator.userAgent;
    data['experimentID'] = experimentID;
    data[taskID+'_start'] = Date.now();
    data[taskID+'_answers'] = answers;
    data[taskID+'_responses'] = {};
    //
    experimentr.hideNext();
    d3.select("#topbar").text("Task "+(task+1)+" of "+experiment.length);
    d3.selectAll(".S").on("click", toggleAnswer);
    d3.selectAll(".E").style("visibility", "hidden");
    d3.selectAll("button").attr("disabled", "disabled");
  }
  function toggleAnswer() {
    var target = d3.event.target;
    var e = d3.select(target); 
    if((data[taskID+'_responses'])[target.id] == true) {
      (data[taskID+'_responses'])[target.id] = false;
      e.attr("style", "background-color:#faa");
    } else {
      (data[taskID+'_responses'])[target.id] = true;
      e.attr("style", "background-color:#afa");
    }
    if(Object.keys(data[taskID+'_responses']).length == Object.keys(data[taskID+'_answers']).length) {
      d3.selectAll("button").attr("disabled", null);
    }
  }
  function submit() {
    data[taskID+'_end'] = Date.now();
    data[taskID+'_time'] = parseFloat(data[taskID+'_end']) - parseFloat(data[taskID+'_start']);
    // 
    var msg = "The correct answers are now shown to the right of your answers. Before continuing, please answer the following question:<br/>Did the correct answers help you understand the meaning of this sentence?<br/>";
    d3.selectAll(".S").on("click", null);
    d3.selectAll(".E").style("visibility", "visible");
    d3.select("#feedback").html(msg+"<button onclick='done(false)'>No</button><button onclick='done(true)'>Yes</button>");
  }
  function done(gotit) {
    task = task + 1;
    d3.select("#topbar").text("");
    data[taskID+'_exitq'] = gotit;
    experimentr.addData(data);
    experimentr.next();
  }
  experimentr.sequence(getsequence()).start();
</script>
