<!DOCTYPE html>

<meta charset="utf-8">
<title>✅❌spec</title>

<script src="components/d3js/d3.v3.min.js"></script>
<script src="experimentr.js"></script>

<style>
  * {
      color: #333;
      font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
    }
  body {
    margin: auto auto auto auto;
    width: 1080px;
  }
  button {
    font-size: large; 
  }
  h1 {
    font-size: 150%;
    margin-top: 0em;
    margin-bottom: .5em;
    margin-left: 0;
    margin-right: 0;
    font-weight: normal;
  }
  ul, ol {
    margin-top: 0em;
    margin-bottom: 0em;
    margin-left: 0em;
    margin-right: 0em;
    padding-left: 1.5em;
  }
  b{
    font-weight: normal;
    text-shadow : 0 0 0 #333;
  }
  i {
    text-shadow : 0 0 0 #333;
  }
  u {
    text-shadow : 0 0 0 #333;
  }
  textarea {
    font-size: 80%;
    width:98%;
    height:50px;
    resize: none;
  }
  #experimentr {
    margin: 0em auto 0em auto;
    width: 1080px;
  }
  #control {
    margin-top: 1em;
  }
  #next-button {
    float: right;
    font-size: xx-large;
    font-weight: bold;
  }
  #examples, #checker {
    border: 1px solid #AAA;
    border-radius: 5px;
    padding: 5px;
    margin: 0px 0px 0px 0px;
    background: #CCC;
  }
  #example, #check {
    border: 1px solid #AAA;
    border-radius: 5px;
    padding: 5px;
    background: #FFF;
  }
  #examples {
    width: 50%;
    float:left;
  }
  #checker {
    width: 45%;
    float: right;  
  }
</style>

<body></body>

<script>
/* OVERALL EXPERIMENT FUNCTIONS */
  function getexperiment() {
    return ['modules/check-ex-spec/simple.html'];
  }
  var data = {};
  var experiment = getexperiment(); 
  var experimentID = experiment.toString();
  function getsequence() {
    var pre = ['modules/check-ex-spec/consent.html'];
    var comment = [];
    var post = ['modules/check-ex-spec/debrief.html'];
    var tasks = comment.concat(experiment);
    return tasks;
  }
/* GENERIC TASK FUNCTIONS */
  function alloyparams() {
    var ex1 = "?ex1=\'"+encodeURIComponent(document.getElementById('example1').value)+"\'";
    ex1 = ex1.replace(/(?:\r\n|\r|\n)/g, '@');
    var ex2 = "&ex2=\'"+encodeURIComponent(document.getElementById('example2').value)+"\'";
    ex2 = ex2.replace(/(?:\r\n|\r|\n)/g, '@');
    var ex3 = "&ex3=\'"+encodeURIComponent(document.getElementById('example3').value)+"\'";
    ex3 = ex3.replace(/(?:\r\n|\r|\n)/g, '@');
    var ex4 = "&ex4=\'"+encodeURIComponent(document.getElementById('example4').value)+"\'";
    ex4 = ex4.replace(/(?:\r\n|\r|\n)/g, '@');
    var ex5 = "&ex5=\'"+encodeURIComponent(document.getElementById('example5').value)+"\'";
    ex5 = ex5.replace(/(?:\r\n|\r|\n)/g, '@');
    return ex1+ex2+ex3+ex4+ex5;
  }
  function runalloy() {
    var req = new XMLHttpRequest();
    var url = "/alloy";
    req.open("GET", url+alloyparams(), false);
    req.send();
    var response = req.response.split('\n');
    var info = response.join('\n');
    d3.select("#out").text(info);
  }
  function init(taskID) {
    data = {};
    data['experimentID'] = experimentID;
    data['_start_'+experimentID+'_'+taskID] = new Date(Date.now()).toString();
    data['_checks_'+experimentID+'_'+taskID] = 0;
    data['_checktime_'+experimentID+'_'+taskID] = [];
    //
    experimentr.hideNext();
    d3.select("#run").on('click', runalloy);
  }
  function check(taskID) {
    //
    data['_checks_'+experimentID+'_'+taskID] = data['_checks_'+experimentID+'_'+taskID] + 1;
    var ctime = new Date(Date.now()).toString();
    data['_checktime_'+experimentID+'_'+taskID] = (data['_checktime_'+experimentID+'_'+taskID]).concat([ctime]);
  }
  function finish(taskID) {
    d3.selectAll('button').attr('disabled', true);
    //
    data['_end_'+experimentID+'_'+taskID] = new Date(Date.now()).toString();
    experimentr.addData(data);
    experimentr.next();
  }
  /* DOCUMENTATION
   all data is recorded in _<metric>_<experimentID><taskID> form
   the <experimentID><taskID> should denote the trial conditions (see example below)
   generic, parameterized code goes here. anything task specific goes in their module
   */
  /*
   CONDITIONS
   experimentID     order of the tasks
   spec             G(gradebook), A(addressbook)
   phrasing         O(original), R(rephrase)
   scenario         M(minimal), C(control)
   */
   experimentr.sequence(getsequence()).start();
</script>
