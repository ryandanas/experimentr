<!DOCTYPE html>

<meta charset="utf-8">
<title>Survey</title>

<script src="/scripts/d3/d3.min.js" charset="utf-8"></script>
<script src="experimentr.js"></script>

<link rel="stylesheet" type="text/css" href="css/main.css" />
<link rel="stylesheet" type="text/css" href="css/toyfinder.css" />

<body></body>

<script>
  /* TODOS
  get rid of the experimentID in the data keys; only need task id
  dont pass task name, keep track of the index and figure out the task name.
  anything else than can be made generic easily?
  clean up documentation
  */
  /* DOCUMENTATION
   all data is recorded in _<metric>_<experimentID><taskID> form
   the <experimentID><taskID> should denote the trial conditions (see example below)
   generic, parameterized code goes here. anything task specific goes in their module
   sorry for the obfuscated names. i did that to avoid quick CTRL+F to win cheaters.
  */
  /*
   CONDITIONS
   experimentID     order of the tasks
   spec             G(gradebook), A(addressbook)
   phrasing         O(original), R(rephrase)
   scenario         M(minimal), C(control)
  */
  /* OVERALL EXPERIMENT FUNCTIONS */
  function getexperiment() {
    return ['modules/AOM.html', 'modules/GOM.html'];
    /*
    if(Math.random() < .5) { return ['modules/AOM.html'] }
    else { return ['modules/AOC.html'] }
    */
  }
  var data = {};
  var experiment = getexperiment(); 
  var experimentID = experiment.toString();
  var junktimer;
  function getsequence() {
    var pre = ['modules/consent/'];
    var post = ['modules/debrief/'];
    var tasks = experiment;
    return pre.concat(tasks).concat(post);
  }
  /* GENERIC TASK FUNCTIONS */
  function init(taskID) {
    data = {};
    data['experimentID'] = experimentID;
    data['_start_'+experimentID+'_'+taskID] = Date.now();
    data['_attempts_'+experimentID+'_'+taskID] = 0;
    data['_attempttime_'+experimentID+'_'+taskID] = [];
    data['_attemptcode_'+experimentID+'_'+taskID] = [];
    //
    d3.selectAll('#N').style("background-color", "#afa");
    d3.selectAll('#A').style("background-color", "#faa");
    d3.selectAll('option').on('click', fail2);
    experimentr.hideNext();
  }
  function fail(taskID) {
    if(!d3.event.target.disabled) {
      data['_attempts_'+experimentID+'_'+taskID] = data['_attempts_'+experimentID+'_'+taskID] + 1;
      var atime = Date.now() - data['_start_'+experimentID+'_'+taskID];
      var acode = d3.event.target.id;
      data['_attempttime_'+experimentID+'_'+taskID] = (data['_attempttime_'+experimentID+'_'+taskID]).concat([atime]);
      data['_attemptcode_'+experimentID+'_'+taskID] = (data['_attemptcode_'+experimentID+'_'+taskID]).concat([acode]);
      //
      var opt = d3.select(d3.event.target); 
      opt.style("background-color", "#faa");
      opt.style("text-decoration" , "line-through");
      opt.attr("disabled", "disabled");
      alert("This option does not satisfy all goals in a single change. The options have been reset for you. Please try again.");
      d3.selectAll('select').property('selectedIndex', 0);
    }
  }
  function pass(taskID) {
    data['_end_'+experimentID+'_'+taskID] = Date.now();
    data['_time_'+experimentID+'_'+taskID] = parseFloat(data['_end_'+experimentID+'_'+taskID]) - parseFloat(data['_start_'+experimentID+'_'+taskID]);
    experimentr.addData(data);
    alert("Correct! This option does satisfy all goals in a single change. Please continue to the next task.");
    experimentr.next();
  }
  experimentr.sequence(getsequence()).start();
</script>
